---
title: "graphs"
output: html_document
date: "2025-07-02"
---
```{r}
install.packages("tidyr")
library(tidyr)
install.packages("ggplot2")
library(ggplot2)
install.packages("stringr")
library(stringr)
```   

Sibling Count: Yes/No?
```{r}
sib_yesno <- table(combined$`Are there any other children who live in your home?`)
sib_yesno <- as.data.frame(sib_yesno)

colnames(sib_yesno)[1] <- "Answer"
colnames(sib_yesno)[2] <- "Count"
```
Sibling Count: Graph
```{r, fig.width = 6, fig.height = 7}
householdplot <- ggplot(sib_yesno, aes(x = Answer, y = Count)) + 
  geom_bar(stat = "identity", fill = "plum") +
  geom_text(aes(label = Count), vjust = -0.5, family = "Times") +
  labs(title = "How Many Households have Siblings?"
  ) + 
  theme_minimal(base_size = 14, base_family = "Times") +
    theme(plot.title = element_text(hjust = 0.5, size = 16, face = "bold")) 

householdplot
```
```{r}
sib_df <- combined %>%
  select(
    parent_ID =  subject_id,
    has_siblings = `Are there any other children who live in your home?`, 
    info = `Please enter the birthday (MM/DD/YYYY) and the sex of the children:`
  )

sib_df <- sib_df %>%
  filter(has_siblings == "Yes", !is.na(info))
```
```{r, fig.width = 10, fig.height = 6}
setwd("/Volumes/Fas-Phyc-PEB-Lab/experimental_projects/PBS/PBS_Full_Study/CN_Working_Folder/R/Survey")
sibship_factors <- read_xlsx("Sibship_Factors.xlsx")

sibship_factors <- sibship_factors %>%
  filter(Sib_Identity != "n/a", Sib_Identity != "", !is.na(Sib_Identity))

ggplot(sibship_factors, aes(x = Sib_Identity))+
  geom_bar(fill = "lightcoral") +
  geom_text(stat = "count", aes(label = ..count..),vjust = -0.3) +
  labs(
    title = "Sibling Identities",
    x = "Sibling Identity",
    y = "Count"
  ) +
  theme_minimal(base_size = 18, base_family = "Times") + 
      theme(plot.title = element_text(hjust = 0.5, size = 18, face = "bold")) 
```

```{r, fig.width = 10, fig.height = 14}
household_counts <- sibship_factors %>%
  filter(Sib_Birthdate != "n/a") %>%   # only valid rows
  group_by(Subject_ID) %>%
  summarise(num_siblings = n(), .groups = "drop")

sib_distribution <- household_counts %>%
  count(num_siblings)

ggplot(sib_distribution, aes(x = as.factor(num_siblings), y = n)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  geom_text(aes(label = n), vjust = -0.3) +
  labs(
    title = "Sibling Count in Households",
    x = "Number of Siblings",
    y = "Number of Households"
  ) +
  theme_minimal(base_size = 20, base_family = "Times") + 
      theme(plot.title = element_text(hjust = 0.5, size = 20, face = "bold")) 
```

Languages in Household
```{r}
lang_other <- table(combined$`Are there any other languages spoken in your home?`)
lang_other <- as.data.frame(lang_other)

colnames(lang_other)[1] <- "Other Language?"
colnames(lang_other)[2] <- "Count"

sum(lang_other$Count)

# sum was to see how many answers were given
```

```{r}
lang_other$`Other Language?` <- tolower(lang_other$`Other Language?`)
lang_other <- aggregate(Count ~ `Other Language?`, data = lang_other, sum)

lang_other <- (lang_other[-c(3,12:14), ])
sum(lang_other$Count)

# out of 65 total obs., only 18 households speak another language (outside of English) (after cleaning and removing English/No answers)
```

CN - to graph next ? combine the common languages to see how many languages are spoken / start data mining the birth orders and see how that looks @ 11:40am 
```{r, fig.width = 6, fig.height = 7}
lang_other <- lang_other %>%
  mutate(Language_Group = case_when(
    grepl(",", `Other Language?`) ~ "Multilingual",  # overrides all
    grepl("spanish", `Other Language?`, ignore.case = TRUE) ~ "Spanish",
    `Other Language?` %in% c("cantonese", "mandarin chinese", "korean", "malyalam", "urdu") ~ "Asian",
    `Other Language?` %in% c("arabic", "farsi", "hebrew") ~ "Middle Eastern",
    `Other Language?` == "russian" ~ "Slavic",
    TRUE ~ NA_character_
  ))

lang_other %>%
  group_by(Language_Group) %>%
  summarise(Count = sum(Count), .groups = "drop") %>%
  ggplot(aes(x = Language_Group, y = Count)) +
  geom_bar(stat = "identity", fill = "plum", width = 0.7) +
  geom_text(aes(label = Count), vjust = -0.5, family = "Times") +
  labs(
    title = "Other Languages Spoken",
    x = "Language Group",
    y = "Count"
  ) +
  theme_minimal(base_size = 12, base_family = "Times") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) 
```


